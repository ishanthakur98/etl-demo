


# 1. Create the Kubernetes Secret (must be done first)
echo "ğŸ”‘ Applying database credentials secret..."
kubectl apply -f db-credentials-secret.yaml

# 2. Create the Persistent Volume Claim (requests storage)
echo "ğŸ’¾ Applying Persistent Volume Claim..."
kubectl apply -f postgres-pvc.yaml

# 3. Create the PostgreSQL Deployment (runs the database pod)
echo "ğŸ˜ Applying PostgreSQL Deployment..."
kubectl apply -f postgres-deployment.yaml

# 4. Create the Service (exposes the database via a stable internal name)
echo "ğŸŒ Applying PostgreSQL Service..."
kubectl apply -f postgres-service.yaml

# 5. Verify the resources are running
echo "--- Verification ---"
echo "Checking Deployment status (should show 1/1 READY):"
kubectl get deploy postgres-database

echo "Checking Pod status (should show 1/1 READY):"
kubectl get pods -l app=postgres

echo "Checking Service details (should show the cluster IP):"
kubectl get svc postgres-service


docker build -t yourusername/my-scheduled-batch:latest .


# Deletes all Jobs created by the 'import-users-cronjob' CronJob.
kubectl delete job -l job-name=import-users-cronjob